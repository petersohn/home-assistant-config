version: 2
jobs:
    test-appdaemon:
        docker:
            - image: kangirigungi/home-assistant-config-test:latest
        steps:
            - checkout
            - run: git submodule update --init --recursive
            - run: ./test/AppDaemonTest/run-test --loglevel=trace --xunit=robot.xml --removekeywords WUKS
            - run: |
                find test/output -depth -name __pycache__ -type d \
                    -exec rm -r '{}' ';'
            - store_artifacts:
                path: test/output
            - store_test_results:
                path: test/output
workflows:
    version: 2
    test:
        jobs:
            - test-appdaemon
