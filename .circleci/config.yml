version: 2
jobs:
    test-appdaemon:
        environment:
            - HASS_PATH: /homeassistant
            - APPDAEMON_PATH: /appdaemon
        docker:
            - image: kangirigungi/home-assistant-config-test:latest
        steps:
            - checkout
            - run: git submodule update --init --recursive
            - run: |
                ./test/AppDaemonTest/run-test --loglevel=trace \
                    --xunit=robot.xml --removekeywords WUKS
            - run: |
                find test/AppDaemonTest/output -depth -name __pycache__ \
                    -type d -exec rm -r '{}' ';'
            - store_artifacts:
                path: test/AppDaemonTest/output
            - store_test_results:
                path: test/AppDaemonTest/output
workflows:
    version: 2
    test:
        jobs:
            - test-appdaemon
