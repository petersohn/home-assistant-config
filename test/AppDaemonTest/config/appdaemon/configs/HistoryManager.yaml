global_modules:
    - aggregator

test_history_manager:
    class: HistoryManager
    module: history
    entity: sensor.test_sensor
    max_interval:
        hours: 1

test_history_manager_switch:
    class: HistoryManager
    module: history
    entity: input_boolean.test_switch
    max_interval:
        hours: 1

aggregated_value:
    class: AggregatedValue
    module: history
    dependencies: test_history_manager
    manager: test_history_manager
    target: sensor.test_sensor_sum
    interval:
        minutes: 3
    aggregator: integral

aggregated_value_base_interval:
    class: AggregatedValue
    module: history
    dependencies: test_history_manager
    manager: test_history_manager
    target: sensor.test_sensor_sum_base_interval
    interval:
        minutes: 3
    base_interval:
        seconds: 10
    aggregator: integral

mean_value:
    class: AggregatedValue
    module: history
    global_dependencies:
        - aggregator
    dependencies: test_history_manager
    manager: test_history_manager
    target: sensor.test_sensor_mean
    interval:
        minutes: 3
    aggregator: mean

test_history_enabler:
    class: HistoryEnabler
    module: enabler
    dependencies: test_history_manager
    manager: test_history_manager
    interval:
        minutes: 5
    aggregator: integral
    base_interval:
        minutes: 1
    min: 10
    max: 20

test_history_enabled_switch:
    class: EnabledSwitch
    module: enabled_switch
    global_dependencies:
        - auto_switch
    dependencies:
        - test_history_enabler_auto_switch
        - test_history_enabler
    enabler: test_history_enabler
    targets:
        - test_history_enabler_auto_switch

test_history_enabler_auto_switch:
    module: auto_switch
    class: AutoSwitch
    target: input_boolean.test_switch
