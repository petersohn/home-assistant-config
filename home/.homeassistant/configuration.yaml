homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret latitude
  longitude: !secret longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: !secret elevation
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: UTC
  customize: !include customize.yaml

# Enables the frontend
frontend:

# Enables configuration UI
config:

http:

# Checks for available updates
# Note: This component will send some information about your system to
# the developers to assist with development of Home Assistant.
# For more information, please see:
# https://home-assistant.io/blog/2016/10/25/explaining-the-updater/
updater:

recorder:
  purge_interval: 1
  purge_keep_days: 5
  db_url: sqlite:///tmp/homeassistant/home-assistant.db

# Enables support for tracking state changes over time.
history:
  exclude:
    domains:
      - group

# View all events in a logbook
logbook:
  exclude:
    entities:
      - sensor.yr_symbol
    domains:
      - group

# Track the sun
sun:

mqtt:
  broker: 127.0.0.1
  port: 1883
  client_id: home-assistant-1
  username: !secret mosquitto_username
  password: !secret mosquitto_pasword

sensor:
  - platform: yr
    monitored_conditions:
      - temperature
      - symbol
      - precipitation
      - windSpeed
      - windDirection
      - humidity
      - cloudiness
  - platform: moon
  - platform: mqtt
    state_topic: home/sensors/temperature/outside
    unit_of_measurement: "°C"
    name: temperature_outside
  - platform: mqtt
    state_topic: home/sensors/humidity/outside
    unit_of_measurement: "%"
    name: humidity_outside
  - platform: mqtt
    state_topic: home/sensors/temperature/outside2
    unit_of_measurement: "°C"
    name: temperature_outside2
  - platform: mqtt
    state_topic: home/sensors/humidity/outside2
    unit_of_measurement: "%"
    name: humidity_outside2
  - platform: mqtt
    state_topic: home/sensors/temperature/furnace_room
    unit_of_measurement: "°C"
    name: temperature_furnace_room
  - platform: mqtt
    state_topic: home/sensors/humidity/furnace_room
    unit_of_measurement: "%"
    name: humidity_furnace_room
  - platform: mqtt
    state_topic: home/sensors/temperature/cellar
    unit_of_measurement: "°C"
    name: temperature_cellar
  - platform: mqtt
    state_topic: home/sensors/humidity/cellar
    unit_of_measurement: "%"
    name: humidity_cellar
  - platform: mqtt
    state_topic: home/sensors/temperature/attic
    unit_of_measurement: "°C"
    name: temperature_attic
  - platform: mqtt
    state_topic: home/sensors/humidity/attic
    unit_of_measurement: "%"
    name: humidity_attic
  - platform: mqtt
    state_topic: home/sensors/temperature/living_room/lower
    unit_of_measurement: "°C"
    name: temperature_living_room_lower
  - platform: mqtt
    state_topic: home/sensors/humidity/living_room/lower
    unit_of_measurement: "%"
    name: humidity_living_room_lower
  - platform: mqtt
    state_topic: home/sensors/temperature/living_room/upper
    unit_of_measurement: "°C"
    name: temperature_living_room_upper
  - platform: mqtt
    state_topic: home/sensors/humidity/living_room/upper
    unit_of_measurement: "%"
    name: humidity_living_room_upper
  - platform: mqtt
    state_topic: home/sensors/temperature/bedroom/lower
    unit_of_measurement: "°C"
    name: temperature_bedroom_lower
  - platform: mqtt
    state_topic: home/sensors/humidity/bedroom/lower
    unit_of_measurement: "%"
    name: humidity_bedroom_lower
  - platform: mqtt
    state_topic: home/sensors/temperature/bedroom/upper
    unit_of_measurement: "°C"
    name: temperature_bedroom_upper
  - platform: mqtt
    state_topic: home/sensors/humidity/bedroom/upper
    unit_of_measurement: "%"
    name: humidity_bedroom_upper
  - platform: mqtt
    state_topic: home/sensors/temperature/kitchen
    unit_of_measurement: "°C"
    name: temperature_kitchen
  - platform: mqtt
    state_topic: home/sensors/humidity/kitchen
    unit_of_measurement: "%"
    name: humidity_kitchen
  - platform: mqtt
    state_topic: home/sensors/temperature/dishwasher
    unit_of_measurement: "°C"
    name: temperature_dishwasher
  - platform: mqtt
    state_topic: home/sensors/water/dishwasher
    unit_of_measurement: "l"
    name: water_usage_dishwasher
  - platform: mqtt
    state_topic: home/sensors/water/main
    unit_of_measurement: "l"
    name: water_usage
  - platform: mqtt
    state_topic: home/sensors/temperature/furnace/gas
    unit_of_measurement: "°C"
    name: temperature_furnace_gas
  - platform: mqtt
    state_topic: home/sensors/temperature/furnace/wood
    unit_of_measurement: "°C"
    name: temperature_furnace_wood
  - platform: mqtt
    state_topic: home/sensors/temperature/furnace/wood_in
    unit_of_measurement: "°C"
    name: temperature_furnace_wood_in
  - platform: mqtt
    state_topic: home/sensors/temperature/hot_water
    unit_of_measurement: "°C"
    name: temperature_hot_water
  - platform: mqtt
    state_topic: home/sensors/wind/direction
    unit_of_measurement: "°"
    name: wind_direction
  - platform: mqtt
    state_topic: home/sensors/wind/strength
    unit_of_measurement: "km/h"
    name: wind_strength
  - platform: mqtt
    state_topic: home/sensors/rain
    unit_of_measurement: "mm"
    name: rain
  - platform: mqtt
    state_topic: home/sensors/light/shadow
    unit_of_measurement: "%"
    name: light_shadow
    value_template: "{{ value | float / 10.24 }}"

  - platform: mqtt
    state_topic: home/devices/well_controller/availability
    name: well_controller_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/well_controller/availability
    name: well_controller_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"
  - platform: mqtt
    state_topic: home/devices/main_controller/availability
    name: main_controller_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/main_controller/availability
    name: main_controller_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"
  - platform: mqtt
    state_topic: home/devices/furnaceTemperature/availability
    name: furnace_temperature_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/furnaceTemperature/availability
    name: furnace_temperature_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"
  - platform: mqtt
    state_topic: home/devices/driveway/availability
    name: driveway_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/driveway/availability
    name: driveway_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"
  - platform: mqtt
    state_topic: home/devices/cellar_controller/availability
    name: cellar_controller_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/cellar_controller/availability
    name: cellar_controller_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"
  - platform: mqtt
    state_topic: home/devices/living_room_temperature/availability
    name: living_room_temperature_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/living_room_temperature/availability
    name: living_room_temperature_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"
  - platform: mqtt
    state_topic: home/devices/bedroom_temperature/availability
    name: bedroom_temperature_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/bedroom_temperature/availability
    name: bedroom_temperature_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"
  - platform: mqtt
    state_topic: home/devices/dishwasher_sensor/availability
    name: dishwasher_sensor_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/dishwasher_sensor/availability
    name: dishwasher_sensor_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"
  - platform: mqtt
    state_topic: home/devices/gate_reflector/availability
    name: gate_reflector_free_memory
    value_template: '{{ value_json.freeMemory }}'
    unit_of_measurement: "b"
  - platform: mqtt
    state_topic: home/devices/gate_reflector/availability
    name: gate_reflector_uptime
    value_template: '{{ value_json.uptime }}'
    unit_of_measurement: "ms"

  - platform: command_line
    command: "df /tmp | tail -n 1 | awk '{print $4}'"
    unit_of_measurement: Kb
    name: tmp_free_space
  - platform: command_line
    command: "df /var/log | tail -n 1 | awk '{print $4}'"
    unit_of_measurement: Kb
    name: var_log_free_space

binary_sensor:
  - platform: mqtt
    state_topic: home/devices/well_controller/availability
    name: well_controller_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/main_controller/availability
    name: main_controller_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/furnaceTemperature/availability
    name: furnace_temperature_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/driveway/availability
    name: driveway_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/cellar_controller/availability
    name: cellar_controller_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/living_room_temperature/availability
    name: living_room_temperature_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/bedroom_temperature/availability
    name: bedroom_temperature_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/dishwasher_sensor/availability
    name: dishwasher_sensor_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/gate_reflector/availability
    name: gate_reflector_available
    value_template: '{{ value_json.available }}'
    payload_on: true
    payload_off: false

  - platform: mqtt
    state_topic: home/devices/well_controller/availability
    name: well_controller_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/main_controller/availability
    name: main_controller_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/furnaceTemperature/availability
    name: furnace_temperature_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/driveway/availability
    name: driveway_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/cellar_controller/availability
    name: cellar_controller_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/living_room_temperature/availability
    name: living_room_temperature_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/bedroom_temperature/availability
    name: bedroom_temperature_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/dishwasher_sensor/availability
    name: dishwasher_sensor_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false
  - platform: mqtt
    state_topic: home/devices/gate_reflector/availability
    name: gate_reflector_restarted
    value_template: '{{ value_json.restarted }}'
    payload_on: true
    payload_off: false

  - platform: mqtt
    state_topic: home/sensors/motion/gate_reflector
    name: motion_sensor_driveway_uppest
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    state_topic: home/sensors/motion/driveway_upper
    name: motion_sensor_driveway_upper
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    state_topic: home/sensors/motion/driveway_lower
    name: motion_sensor_driveway_lower
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    state_topic: "$SYS/broker/connection/hassbian.homeassistant_gateway/state"
    name: mosquitto_bridge_available
    payload_on: 1
    payload_off: 0
  - platform: ping
    host: !secret router_address
    name: network_available
  - platform: ping
    host: !secret desktop_address
    name: desktop_available
  - platform: ping
    host: google.com
    name: internet_available
  - platform: ping
    host: !secret gateway_address
    name: gateway_available
  - platform: command_line
    command: 'timeout 2 netcat localhost 8888 </dev/null && echo ON || echo OFF'
    name: ssh_tunnel_available

  - platform: tod
    name: Night
    after: sunset
    after_offset: 00:10
    before: sunrise
    before_offset: -00:10

switch:
  - platform: mqtt
    name: well
    command_topic: home/switches/well/set
    state_topic: home/switches/well/state
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: heating_pump
    command_topic: home/switches/heating_pump/set
    state_topic: home/switches/heating_pump/status
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: light_driveway
    command_topic: home/switches/lights/driveway/set
    state_topic: home/switches/lights/driveway/state
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: light_attic_downstairs
    command_topic: home/switches/lights/attic/downstairs/set
    state_topic: home/switches/lights/attic/downstairs/state
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: light_attic_upstairs
    command_topic: home/switches/lights/attic/upstairs/set
    state_topic: home/switches/lights/attic/upstairs/state
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: light_cellar
    command_topic: home/switches/lights/cellar/set
    state_topic: home/switches/lights/cellar/state
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: light_garage
    command_topic: home/switches/lights/garage/set
    state_topic: home/switches/lights/garage/state
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: light_christmas_front
    command_topic: home/switches/lights/christmas/front/set
    state_topic: home/switches/lights/christmas/front/state
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: light_christmas_tree
    command_topic: home/switches/lights/christmas/tree/set
    state_topic: home/switches/lights/christmas/tree/state
    payload_on: 1
    payload_off: 0
  - platform: mqtt
    name: light_gate_reflector
    command_topic: home/switches/lights/gate_reflector/set
    state_topic: home/switches/lights/gate_reflector/state
    payload_on: 1
    payload_off: 0

input_select:
    light_driveway:
        name: Bejáró világítás
        options:
            - "auto"
            - "on"
            - "off"
        initial: "auto"
    light_gate_reflector:
        name: Kapu reflektor
        options:
            - "auto"
            - "on"
            - "off"
        initial: "auto"
    light_christmas_front:
        name: Karácsonyi világítás eresz alatt
        options:
            - "auto"
            - "on"
            - "off"
        initial: "auto"
    light_christmas_tree:
        name: Karácsonyi világítás fenyőfa
        options:
            - "auto"
            - "on"
            - "off"
        initial: "auto"

mqtt_statestream:
  base_topic: home
  include:
    domains:
      - input_select

influxdb:
  host: !secret influxdb_address
  port: 8086
  ssl: true
  verify_ssl: true
  username: !secret influxdb_username
  password: !secret influxdb_password
  database: !secret influxdb_database

system_health:

group: !include groups.yaml
automation: !include automations.yaml
script: !include script.yaml
