homeassistant:
  # Name of the location where Home Assistant is running
  name: Home
  # Location required to calculate the time the sun rises and sets
  latitude: !secret latitude
  longitude: !secret longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: !secret elevation
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: Europe/Budapest
  customize: !include customize.yaml

# Enables the frontend
frontend:

# Enables configuration UI
config:

homeassistant_alerts:

http:
    use_x_forwarded_for: true
    trusted_proxies:
      - 127.0.0.1
      - ::1

lovelace:
  mode: yaml

mobile_app:

zone:
  - name: Home
    latitude: !secret latitude
    longitude: !secret longitude
    radius: 150
    icon: mdi:home

recorder:
  auto_purge: true
  purge_keep_days: 14
  db_url: !secret db_location

# Enables support for tracking state changes over time.
history:
  exclude:
    domains:
      - group

# View all events in a logbook
logbook:
  exclude:
    domains:
      - group

# Track the sun
sun:

mqtt: !include mqtt.yaml

sensor:
  - platform: time_date
    display_options:
      - 'date'
      - 'time'
      - 'date_time'
  - platform: moon
  - platform: command_line
    name: cpu_temperature
    command: "cat /sys/class/thermal/thermal_zone0/temp"
    # If errors occur, make sure configuration file is encoded as UTF-8
    unit_of_measurement: "°C"
    value_template: "{{ value | multiply(0.001) }}"
    scan_interval: 10

binary_sensor:
  - platform: ping
    host: !secret router_address
    name: network_available
  - platform: ping
    host: !secret desktop_address
    name: desktop_available
  - platform: ping
    host: google.com
    name: internet_available
  - platform: ping
    host: !secret gateway_address
    name: gateway_available
  - platform: command_line
    command: 'timeout 2 nc localhost 8888 </dev/null && echo ON || echo OFF'
    name: ssh_tunnel_available

  - platform: tod
    name: Night
    after: sunset
    after_offset: 00:10
    before: sunrise
    before_offset: -00:10

climate:
  - platform: generic_thermostat
    name: heater
    heater: switch.heater
    target_sensor: sensor.heater_target
    min_temp: 10
    max_temp: 25
    ac_mode: false
    cold_tolerance: 1
    hot_tolerance: 0
    min_cycle_duration:
      minutes: 5
    keep_alive:
      seconds: 15
    initial_hvac_mode: "off"
    away_temp: 10
    precision: 0.5

media_player:
  - platform: clementine
    name: desktop
    host: !secret desktop_address

template:
  - binary_sensor:
    - name: presence_home
      state: >
        {{ is_state('input_select.presence_mode', 'home') }}
  - binary_sensor:
    - name: presence_sleep
      state: >
        {{ is_state('input_select.presence_mode', 'sleep') }}
  - binary_sensor:
    - name: presence_away
      state: >
        {{ is_state('input_select.presence_mode', 'away') }}

input_select:
    light_driveway:
        name: Bejáró világítás
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:outdoor-lamp
    light_well:
        name: Kút világítás
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:spotlight
    light_gate_reflector:
        name: Kapu reflektor
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:spotlight
    light_garage:
        name: Garázs világítás
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:lightbulb
    light_christmas_front:
        name: Karácsonyi világítás eresz alatt
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:string-lights
    light_christmas_tree:
        name: Karácsonyi világítás fenyőfa
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:pine-tree
    light_outside_1:
        name: Körvilágítás 1
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:coach-lamp
    light_outside_2:
        name: Körvilágítás 2
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:coach-lamp
    light_outside_3:
        name: Körvilágítás 3
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:coach-lamp
    light_outside_4:
        name: Körvilágítás 4
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:coach-lamp
    light_outside_5:
        name: Körvilágítás 5
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:coach-lamp
    light_outside_6:
        name: Körvilágítás 6
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:coach-lamp
    auto_sprinkler1:
        name: Auto locsoló 1
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:sprinkler
    auto_sprinkler2:
        name: Auto locsoló 2
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:sprinkler
    auto_sprinkler3:
        name: Auto locsoló 3
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:sprinkler
    auto_sprinkler_cellar:
        name: Auto locsoló pince
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:sprinkler
    balcony_sprinkler:
        name: Terasz locsoló
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:sprinkler
    hot_water_pump:
        name: Melegvíz
        options:
            - "auto"
            - "on"
            - "off"
    socket_bedroom_1:
        name: Hálószoba konnektor 1
        options:
            - "auto"
            - "on"
            - "off"
        icon: mdi:power-socket-eu
    socket_bedroom_1_mode:
        name: Hálószoba konnektor 1 mód
        options:
            - "off"
            - "karácsonyfa"
            - "szúnyogirtó"
        icon: mdi:power-socket-eu
    presence_mode:
        name: Jelenlét mód
        options:
            - "home"
            - "away"
            - "sleep"
        icon: mdi:home

input_boolean:
  sprinkler:
    name: "Locsolás"
    icon: mdi:sprinkler-variant
  wood_heating:
    name: "Fafűtés"
    icon: mdi:fireplace
  start_sprinkler_cellar:
    name: "Pince locsolás start"
    icon: mdi:sprinkler
  test_alert:
    name: "Teszt riasztás"
    icon: mdi:alert
  skip_balcony_watering:
    name: Terasz locsolás kihagyása
    icon: mdi:water-off

  furnace_temperature_maintenance:
    name: Furnace Temperature
    icon: mdi:wrench
  well_controller_maintenance:
    name: Well Controller
    icon: mdi:wrench
  main_controller_maintenance:
    name: Main Controller
    icon: mdi:wrench
  main_controller2_maintenance:
    name: Main Controller 2
    icon: mdi:wrench
  driveway_maintenance:
    name: Driveway
    icon: mdi:wrench
  cellar_controller_maintenance:
    name: Cellar Controller
    icon: mdi:wrench
  living_room_temperature_maintenance:
    name: Living Room Temperature
    icon: mdi:wrench
  bedroom_temperature_maintenance:
    name: Bedroom Temperature
    icon: mdi:wrench
  dishwasher_sensor_maintenance:
    name: Dishwasher Sensor
    icon: mdi:wrench
  gate_reflector_maintenance:
    name: Gate Reflector
    icon: mdi:wrench
  attic_lower_maintenance:
    name: Attic Lower
    icon: mdi:wrench
  dining_room_window_maintenance:
    name: Dining Room Window
    icon: mdi:wrench
  living_room_window_maintenance:
    name: Living Room Window
    icon: mdi:wrench
  balcony_controller_maintenance:
    name: Balcony Controller
    icon: mdi:wrench

input_number:
  sprinkler_cellar_day:
    name: "Pince locsolás napja"
    min: 0
    max: 28
    icon: mdi:calendar

mqtt_statestream:
  base_topic: home
  include:
    domains:
      - input_select
      - sensor
      - binary_sensor

influxdb:
  host: localhost
  port: 8086
  username: !secret influxdb_username
  password: !secret influxdb_password
  database: !secret influxdb_database

telegram_bot:
  - platform: polling
    api_key: !secret telegram_api_key
    allowed_chat_ids:
      - !secret telegram_chat_id

notify:
  - name: telegram_alert
    platform: telegram
    chat_id: !secret telegram_chat_id

alert:
  availability:
    name: Availability
    message: |
      Néhány ESP nem működik.

      ```
      {{state_attr('binary_sensor.availability_alert', 'text')}}
      ```
    entity_id: binary_sensor.availability_alert
    state: 'on'
    repeat:
      - 10
      - 60
    can_acknowledge: true
    notifiers:
      - telegram_alert
  window_open:
    name: Ablak nyitva
    message: |
      Valami nyitva maradt.

      ```
      {{state_attr('binary_sensor.window_alert', 'text')}}
      ```
    entity_id: binary_sensor.window_alert
    state: 'on'
    repeat:
      - 1
      - 5
      - 10
      - 30
    can_acknowledge: true
    notifiers:
      - telegram_alert
  freeze:
    name: Fagyás
    message: |
      Fagyás.

      ```
      {{state_attr('binary_sensor.freeze_alert', 'text')}}
      ```
    entity_id: binary_sensor.freeze_alert
    state: 'on'
    repeat:
      - 30
      - 60
    can_acknowledge: true
    notifiers:
      - telegram_alert
  # tracker_update:
  #   name: Pozíció jelzés hiányzik
  #   message: >
  #     Pozíció nincs frissítve
  #     {{states('sensor.tracker_last_updated')}}
  #     perce.
  #   entity_id: binary_sensor.tracker_not_updated
  #   state: 'on'
  #   repeat:
  #     - 60
  #   can_acknowledge: true
  #   notifiers:
  #     - telegram_alert
  furnace_overheat:
    name: Kazán túlmelegedés
    message: >
      Kazán túlmelegedés: {{states('sensor.temperature_furnace_wood')}} °C
    entity_id: binary_sensor.furnace_overheat
    state: 'on'
    skip_first: true
    repeat:
      - 1
      - 5
    can_acknowledge: true
    notifiers:
      - telegram_alert
  no_hot_water:
    name: Nincs melegvíz
    message: Nincs melegvíz
    entity_id: binary_sensor.no_hot_water
    state: 'on'
    skip_first: true
    repeat:
      - 5
      - 5
      - 30
    can_acknowledge: true
    notifiers:
      - telegram_alert
  test:
    name: Teszt riasztás
    message: >
      Teszt riaszás
    entity_id: input_boolean.test_alert
    state: 'on'
    repeat:
      - 1
    can_acknowledge: true
    notifiers:
      - telegram_alert

system_health:

automation: !include automations.yaml
script: !include script.yaml
