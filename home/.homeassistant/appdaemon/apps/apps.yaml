global_modules:
    - mutex_graph

locker:
    module: locker
    class: Locker
    global_dependencies: mutex_graph
    enable_logging: false

wind_direction_yr:
    class: WindDirection
    module: wind_direction
    entity: sensor.yr_wind_direction

wind_direction:
    class: WindDirection
    module: wind_direction
    entity: sensor.wind_direction

wind_direction_average_icon:
    class: WindDirection
    module: wind_direction
    entity: sensor.wind_direction_average

heating_pump:
    class: TemperatureBasic
    module: temperature_basic
    dependencies: locker
    sensor_out: sensor.temperature_furnace_wood
    sensor_in: sensor.temperature_furnace_wood_in
    outside_sensor: sensor.temperature_outside
    target: switch.heating_pump
    target_difference: 6
    tolerance: 1
    maximum_out: 80
    minimum_out: 30

auto_switch_light_driveway:
    module: auto_switch
    class: AutoSwitch
    dependencies: locker
    target: switch.light_driveway
    switch: input_select.light_driveway
    reentrant: true

auto_switch_light_gate_reflector:
    module: auto_switch
    class: AutoSwitch
    dependencies: locker
    target: switch.light_gate_reflector
    switch: input_select.light_gate_reflector
    reentrant: true

auto_switch_light_garage:
    module: auto_switch
    class: AutoSwitch
    dependencies: locker
    target: switch.light_garage
    switch: input_select.light_garage
    reentrant: true

sun_enabler_night:
    module: enabler
    class: ValueEnabler
    dependencies: locker
    entity: binary_sensor.night
    value: 'on'

wind_short_term:
    module: history
    class: HistoryManager
    dependencies: locker
    entity: sensor.wind_strength

wind_direction_short_term:
    module: history
    class: HistoryManager
    dependencies: locker
    entity: sensor.wind_direction

wind_disabler:
    module: enabler
    class: HistoryEnabler
    dependencies:
        - wind_short_term
        - locker
    manager: wind_short_term
    aggregator: max
    max: 50
    interval:
        minutes: 10
    default: 0

wind_direction_average:
    module: history
    class: AggregatedValue
    dependencies:
        - wind_direction_short_term
        - locker
    manager: wind_direction_short_term
    target: sensor.wind_direction_average
    interval:
        minutes: 10
    base_interval:
        seconds: 10
    aggregator: anglemean
    attributes:
        unit_of_measurement: "°"
        friendly_name: "Szélirány"

motion_sensor_driveway_uppest_history:
    module: history
    class: HistoryManager
    dependencies: locker
    entity: binary_sensor.motion_sensor_driveway_uppest

motion_sensor_driveway_uppest_average:
    module: history
    class: AggregatedValue
    dependencies:
        - motion_sensor_driveway_uppest_history
        - locker
    manager: motion_sensor_driveway_uppest_history
    target: sensor.motion_sensor_driveway_uppest_average
    interval:
        hours: 1
    aggregator: mean
    attributes:
        friendly_name: "Bejáró legfelső"
        icon: mdi:percent

motion_sensor_driveway_uppest_lockout:
    module: enabler
    class: RangeEnabler
    dependencies:
        - locker
        - motion_sensor_driveway_uppest_average
    entity: sensor.motion_sensor_driveway_uppest_average
    max: 0.2

motion_sensor_driveway_upper_history:
    module: history
    class: HistoryManager
    dependencies: locker
    entity: binary_sensor.motion_sensor_driveway_upper

motion_sensor_driveway_upper_average:
    module: history
    class: AggregatedValue
    dependencies:
        - motion_sensor_driveway_upper_history
        - locker
    manager: motion_sensor_driveway_upper_history
    target: sensor.motion_sensor_driveway_upper_average
    interval:
        hours: 1
    aggregator: mean
    attributes:
        friendly_name: "Bejáró felső"
        icon: mdi:percent

motion_sensor_driveway_upper_lockout:
    module: enabler
    class: RangeEnabler
    dependencies:
        - locker
        - motion_sensor_driveway_upper_average
    entity: sensor.motion_sensor_driveway_upper_average
    max: 0.2

motion_sensor_driveway_lower_history:
    module: history
    class: HistoryManager
    dependencies: locker
    entity: binary_sensor.motion_sensor_driveway_lower

motion_sensor_driveway_lower_average:
    module: history
    class: AggregatedValue
    dependencies:
        - motion_sensor_driveway_lower_history
        - locker
    manager: motion_sensor_driveway_lower_history
    target: sensor.motion_sensor_driveway_lower_average
    interval:
        hours: 1
    aggregator: mean
    attributes:
        friendly_name: "Bejáró alsó"
        icon: mdi:percent

motion_sensor_driveway_lower_lockout:
    module: enabler
    class: RangeEnabler
    dependencies:
        - locker
        - motion_sensor_driveway_lower_average
    entity: sensor.motion_sensor_driveway_lower_average
    max: 0.2

motion_sensor_garage_history:
    module: history
    class: HistoryManager
    dependencies: locker
    entity: binary_sensor.motion_sensor_garage

motion_sensor_garage_average:
    module: history
    class: AggregatedValue
    dependencies:
        - motion_sensor_garage_history
        - locker
    manager: motion_sensor_garage_history
    target: sensor.motion_sensor_garage_average
    interval:
        hours: 1
    aggregator: mean
    attributes:
        friendly_name: "Garázs"
        icon: mdi:percent

motion_sensor_garage_lockout:
    module: enabler
    class: RangeEnabler
    dependencies:
        - locker
        - motion_sensor_garage_average
    entity: sensor.motion_sensor_garage_average
    max: 0.2

motion_sensor_enabler:
    module: enabler
    class: MultiEnabler
    dependencies:
        - sun_enabler_night
        - locker
    enablers:
        - sun_enabler_night

driveway_motion_sensor:
    class: MotionSensor
    module: motion_sensor
    dependencies:
        - auto_switch_light_driveway
        - motion_sensor_enabler
        - motion_sensor_driveway_uppest_lockout
        - motion_sensor_driveway_upper_lockout
        - motion_sensor_driveway_lower_lockout
        - locker
    enabled_sensors:
        binary_sensor.motion_sensor_driveway_uppest: motion_sensor_driveway_uppest_lockout
        binary_sensor.motion_sensor_driveway_upper: motion_sensor_driveway_upper_lockout
        binary_sensor.motion_sensor_driveway_lower: motion_sensor_driveway_lower_lockout
    targets:
        - auto_switch_light_driveway
    enabler: motion_sensor_enabler
    time: 2

gate_reflector_motion_sensor:
    class: MotionSensor
    module: motion_sensor
    dependencies:
        - auto_switch_light_gate_reflector
        - motion_sensor_enabler
        - motion_sensor_driveway_uppest_lockout
        - motion_sensor_driveway_upper_lockout
        - locker
    enabled_sensors:
        binary_sensor.motion_sensor_driveway_uppest: motion_sensor_driveway_uppest_lockout
        binary_sensor.motion_sensor_driveway_upper: motion_sensor_driveway_upper_lockout
    targets:
        - auto_switch_light_gate_reflector
    enabler: motion_sensor_enabler
    time: 1

garage_motion_sensor:
    class: MotionSensor
    module: motion_sensor
    dependencies:
        - auto_switch_light_garage
        - motion_sensor_enabler
        - motion_sensor_garage_lockout
        - locker
    enabled_sensors:
        binary_sensor.motion_sensor_garage: motion_sensor_garage_lockout
    targets:
        - auto_switch_light_garage
    enabler: motion_sensor_enabler
    time: 3

christmas_light_switch_front:
    module: auto_switch
    class: AutoSwitch
    dependencies: locker
    target: switch.light_christmas_front
    switch: input_select.light_christmas_front

christmas_light_switch_tree:
    module: auto_switch
    class: AutoSwitch
    dependencies: locker
    target: switch.light_christmas_tree
    switch: input_select.light_christmas_tree

christmas_lights_date_enabler:
    module: enabler
    class: DateEnabler
    dependencies: locker
    begin: 11-15
    end: 02-28

christmas_lights_enabler:
    module: enabler
    class: MultiEnabler
    dependencies:
        - christmas_lights_date_enabler
        - sun_enabler_night
        - locker
    enablers:
        - christmas_lights_date_enabler
        - sun_enabler_night

christmas_light_switcher:
    class: EnabledSwitch
    module: enabled_switch
    dependencies:
        - christmas_light_switch_front
        - christmas_light_switch_tree
        - christmas_lights_enabler
        - locker
    global_dependencies:
        - auto_switch
    enabler: christmas_lights_enabler
    targets:
        - christmas_light_switch_front
        - christmas_light_switch_tree
