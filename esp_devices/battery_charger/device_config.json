{
    "debug": true,
    "name": "battery_charger",
    "availabilityTopic": "home/devices/battery_charger/available",
    "statusTopic": "home/devices/battery_charger/status",
    "debugTopic": "home/devices/battery_charger/debug",
    "analogInputs": [
        {
            "name": "mcp",
            "type": "mcp3008",
            "sck": 0,
            "mosi": 2,
            "miso": 14,
            "cs": 12
        }
    ],
    "interfaces": [
        {
            "type": "analog",
            "name": "voltage",
            "intervalMs": 500,
            "input": "mcp.0",
            "max": 18.1,
            "precision": 1,
            "aggregateTime": 200
        },
        {
            "type": "analog",
            "name": "current",
            "intervalMs": 500,
            "input": "mcp.1",
            "max": 40,
            "valueOffset": 20,
            "cutoff": 0.1,
            "precision": 2,
            "aggregateTime": 200
        },
        {
            "type": "output",
            "name": "switch",
            "invert": true,
            "default": 0,
            "commandTopic": "home/battery_charger/set",
            "pin": 16
        }
    ],
    "actions": [
        {
            "type": "publish",
            "interface": "switch",
            "topic": "home/battery_charger/state",
            "retain": true
        },
        {
            "type": "publish",
            "interface": "voltage",
            "topic": "home/battery_charger/voltage/avg",
            "template": "%1",
            "minimumSendInterval": 60000,
            "sendDiff": 0.5,
            "retain": false
        },
        {
            "type": "publish",
            "interface": "voltage",
            "topic": "home/battery_charger/voltage/max",
            "template": "%2",
            "minimumSendInterval": 60000,
            "sendDiff": 0.5,
            "retain": false
        },
        {
            "type": "publish",
            "interface": "current",
            "topic": "home/battery_charger/current/avg",
            "template": "%1",
            "minimumSendInterval": 60000,
            "sendDiff": 0.1,
            "retain": false
        },
        {
            "type": "publish",
            "interface": "current",
            "topic": "home/battery_charger/current/max",
            "template": "%2",
            "minimumSendInterval": 60000,
            "sendDiff": 0.1,
            "retain": false
        },
        {
            "type": "command",
            "interface": "voltage",
            "target": "switch",
            "command": {
                "type": "if",
                "cond": {
                    "type": "&",
                    "ops": [
                        {
                            "type": ">=",
                            "ops": [{"type": "value", "index": 1}, 2]
                        },
                        {
                            "type": "<",
                            "ops": [{"type": "value", "index": 1}, 12.5]
                        }
                    ]
                },
                "then": "1",
                "else": {
                    "type": "if",
                    "cond": {
                        "type": "|",
                        "ops": [
                            {
                                "type": "<",
                                "ops": [{"type": "value", "index": 1}, 2]
                            },
                            {
                                "type": ">",
                                "ops": [{"type": "value", "index": 1}, 15.5]
                            }
                        ]
                    },
                    "then": "0",
                    "else": ""
                }
            }
        }
    ]
}
